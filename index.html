<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ú® Locky & Hoah - Cyber Music Hub</title>
    <style>
        :root {
            --bg: #050505;
            --gradient: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            --card: rgba(255, 255, 255, 0.08);
            --text: #ffffff;
            --accent: #00f2fe;
            --hoah-color: #00d2ff;
            --locky-color: #00ff87;
            --glass: blur(20px);
        }

        body {
            background: var(--bg);
            background-image: radial-gradient(circle at 50% 50%, #1a1a2e 0%, #050505 100%);
            color: var(--text);
            font-family: 'Segoe UI', Roboto, sans-serif;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        /* ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿØÿÆŸàŸÑ */
        #login-overlay {
            position: fixed; top:0; left:0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 3000; display: flex;
            align-items: center; justify-content: center;
        }

        .welcome-card {
            background: var(--card); backdrop-filter: var(--glass);
            padding: 50px; border-radius: 40px; border: 1px solid rgba(255,255,255,0.1);
            text-align: center; box-shadow: 0 0 50px rgba(0,242,254,0.2);
        }

        /* ÿßŸÑÿ≠ÿßŸàŸäÿßÿ™ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© */
        .main-content { 
            display: none; width: 100%; max-width: 1300px; gap: 20px; 
            grid-template-columns: 1fr 380px 300px;
        }

        .glass-panel {
            background: var(--card); backdrop-filter: var(--glass);
            padding: 25px; border-radius: 30px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
        }

        /* ŸÑÿπÿ®ÿ© X-O */
        .xo-board {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px;
        }
        .xo-cell {
            aspect-ratio: 1/1; background: rgba(255,255,255,0.05);
            border-radius: 15px; display: flex; align-items: center;
            justify-content: center; font-size: 2rem; font-weight: bold;
            cursor: pointer; transition: 0.2s;
        }
        .xo-cell:hover { background: rgba(255,255,255,0.1); }
        .xo-cell.X { color: var(--hoah-color); text-shadow: 0 0 10px var(--hoah-color); }
        .xo-cell.O { color: var(--locky-color); text-shadow: 0 0 10px var(--locky-color); }

        /* ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ¥ÿßÿ™ */
        #chat-messages {
            height: 400px; overflow-y: auto; padding: 10px;
            display: flex; flex-direction: column; gap: 10px;
        }
        .msg {
            padding: 12px 18px; border-radius: 20px; font-size: 0.9rem;
            max-width: 80%; line-height: 1.4; animation: pop 0.3s ease;
        }
        .msg.Hoah { background: linear-gradient(135deg, #0082ff, #00d2ff); align-self: flex-start; }
        .msg.Locky { background: linear-gradient(135deg, #05a153, #00ff87); align-self: flex-end; color: #000; }

        /* ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿßÿ™ÿµÿßŸÑ */
        .call-btn {
            background: #ff3b30; color: white; border-radius: 50%;
            width: 50px; height: 50px; display: flex; align-items: center; justify-content: center;
            cursor: pointer; border: none; font-size: 1.2rem;
        }
        .call-active { animation: pulse-red 1.5s infinite; }

        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(255, 59, 48, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(255, 59, 48, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 59, 48, 0); }
        }

        /* ÿ™ŸÜÿ≥ŸäŸÇÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ© */
        button {
            border: none; border-radius: 12px; padding: 10px 20px;
            cursor: pointer; font-weight: 600; transition: 0.3s;
        }
        input, textarea {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            color: white; padding: 12px; border-radius: 15px; width: 100%;
        }
        .selected { background: var(--accent) !important; color: black; }

    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="welcome-card">
            <h1 style="font-size: 3rem; margin-bottom: 0;">VOYAGER</h1>
            <p style="opacity: 0.5; letter-spacing: 2px;">PREMIUM HUB</p>
            <div style="display: flex; gap: 20px; margin-top: 40px;">
                <button onclick="setUser('Hoah')" style="background: var(--hoah-color); color: #000; width: 150px; height: 60px;">I am Hoah</button>
                <button onclick="setUser('Locky')" style="background: var(--locky-color); color: #000; width: 150px; height: 60px;">I am Locky</button>
            </div>
        </div>
    </div>

    <div class="main-content" id="content">
        
        <div class="glass-panel">
            <h2 style="margin-top:0">üéµ Music Vibe</h2>
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                <button id="type-Song" onclick="selectType('Song')" style="flex:1; background:rgba(255,255,255,0.1)">Song</button>
                <button id="type-Playlist" onclick="selectType('Playlist')" style="flex:1; background:rgba(255,255,255,0.1)">Playlist</button>
            </div>
            <textarea id="spotify-input" placeholder="Paste Spotify embed here..." oninput="checkInputs()"></textarea>
            <button id="publish-btn" onclick="publishLink()" style="width:100%; margin-top:10px; background:var(--accent); color:black; display:none">Share to Feed</button>
            
            <div id="music-list" style="margin-top: 25px; height: 400px; overflow-y:auto;"></div>
        </div>

        <div class="glass-panel" style="display:flex; flex-direction:column;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h2 style="margin:0">üí¨ Chat</h2>
                <div style="display:flex; gap:10px;">
                    <button id="voice-call-btn" class="call-btn" style="background:#4cd964" onclick="startCall('voice')">üìû</button>
                    <button id="video-call-btn" class="call-btn" onclick="startCall('video')">üìπ</button>
                </div>
            </div>
            
            <div id="chat-messages"></div>
            
            <div style="display:flex; gap:10px; margin-top:15px;">
                <input type="text" id="chat-input" placeholder="Say something...">
                <button onclick="sendMessage()" style="background:var(--accent); color:black">Send</button>
            </div>
        </div>

        <div class="glass-panel">
            <h2 style="margin-top:0">üéÆ Gaming</h2>
            <div style="text-align:center; background:rgba(255,255,255,0.05); padding:10px; border-radius:15px;">
                <p id="game-status" style="margin:0; font-size:0.8rem;">Hoah (X) vs Locky (O)</p>
            </div>
            <div class="xo-board" id="xo-board">
                <div class="xo-cell" onclick="makeMove(0)"></div>
                <div class="xo-cell" onclick="makeMove(1)"></div>
                <div class="xo-cell" onclick="makeMove(2)"></div>
                <div class="xo-cell" onclick="makeMove(3)"></div>
                <div class="xo-cell" onclick="makeMove(4)"></div>
                <div class="xo-cell" onclick="makeMove(5)"></div>
                <div class="xo-cell" onclick="makeMove(6)"></div>
                <div class="xo-cell" onclick="makeMove(7)"></div>
                <div class="xo-cell" onclick="makeMove(8)"></div>
            </div>
            <button onclick="resetGame()" style="width:100%; margin-top:15px; background:rgba(255,255,255,0.1)">Reset Game</button>
        </div>

    </div>

    <audio id="ringtone" src="https://assets.mixkit.net/active_storage/sfx/1359/1359-preview.mp3" loop></audio>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, set, serverTimestamp, query, limitToLast } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDdLJq7F6r6O9XZTQTIpwdrLR0ZySLGQrY",
            authDomain: "shkl-1db60.firebaseapp.com",
            databaseURL: "https://shkl-1db60-default-rtdb.firebaseio.com",
            projectId: "shkl-1db60",
            storageBucket: "shkl-1db60.firebasestorage.app",
            messagingSenderId: "83946018492",
            appId: "1:83946018492:web:3cfa51fa2ddebee27de2b9"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let currentUser = '';
        let selectedType = '';

        // --- ŸÜÿ∏ÿßŸÖ ÿßŸÑÿØÿÆŸàŸÑ ---
        window.setUser = (user) => {
            currentUser = user;
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('content').style.display = 'grid';
        };

        // --- ŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖŸàÿ≥ŸäŸÇŸâ ---
        window.selectType = (type) => {
            selectedType = type;
            document.getElementById('type-Song').className = type === 'Song' ? 'selected' : '';
            document.getElementById('type-Playlist').className = type === 'Playlist' ? 'selected' : '';
            checkInputs();
        };

        window.checkInputs = () => {
            const input = document.getElementById('spotify-input').value;
            document.getElementById('publish-btn').style.display = (selectedType && input.includes('iframe')) ? 'block' : 'none';
        };

        window.publishLink = async () => {
            const rawInput = document.getElementById('spotify-input').value;
            const src = rawInput.match(/src=["']([^"']+)["']/)?.[1];
            if (src) {
                await push(ref(db, 'music'), { user: currentUser, type: selectedType, link: src });
                document.getElementById('spotify-input').value = '';
            }
        };

        onValue(ref(db, 'music'), (snap) => {
            const list = document.getElementById('music-list');
            list.innerHTML = '';
            const data = snap.val();
            if (data) {
                Object.values(data).reverse().forEach(item => {
                    list.innerHTML += `<div style="margin-bottom:15px; background:rgba(255,255,255,0.05); padding:10px; border-radius:15px;">
                        <small>${item.user} shared a ${item.type}</small>
                        <iframe src="${item.link}" width="100%" height="80" frameBorder="0" style="border-radius:10px; margin-top:5px"></iframe>
                    </div>`;
                });
            }
        });

        // --- ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ¥ÿßÿ™ ---
        window.sendMessage = async () => {
            const input = document.getElementById('chat-input');
            if (!input.value.trim()) return;
            await push(ref(db, 'messages'), { user: currentUser, text: input.value, timestamp: serverTimestamp() });
            input.value = '';
        };

        onValue(query(ref(db, 'messages'), limitToLast(20)), (snap) => {
            const chat = document.getElementById('chat-messages');
            chat.innerHTML = '';
            snap.forEach(child => {
                const m = child.val();
                chat.innerHTML += `<div class="msg ${m.user}"><strong>${m.user}:</strong><br>${m.text}</div>`;
            });
            chat.scrollTop = chat.scrollHeight;
        });

        // --- ŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖŸÉÿßŸÑŸÖÿßÿ™ (ŸÖÿ≠ÿßŸÉÿßÿ©) ---
        window.startCall = (type) => {
            const btn = type === 'voice' ? document.getElementById('voice-call-btn') : document.getElementById('video-call-btn');
            const ring = document.getElementById('ringtone');
            
            if (btn.classList.contains('call-active')) {
                btn.classList.remove('call-active');
                ring.pause();
                alert("Call Ended");
            } else {
                btn.classList.add('call-active');
                ring.play();
                alert(`Calling ${currentUser === 'Hoah' ? 'Locky' : 'Hoah'}...`);
            }
        };

        // --- ŸÑÿπÿ®ÿ© X-O ŸÖÿ™ÿ≤ÿßŸÖŸÜÿ© ---
        const gameRef = ref(db, 'game');
        window.makeMove = (index) => {
            onValue(gameRef, (snap) => {
                const game = snap.val() || { board: Array(9).fill(''), turn: 'Hoah' };
                if (game.board[index] === '' && game.turn === currentUser) {
                    game.board[index] = currentUser === 'Hoah' ? 'X' : 'O';
                    game.turn = currentUser === 'Hoah' ? 'Locky' : 'Hoah';
                    set(gameRef, game);
                }
            }, { onlyOnce: true });
        };

        window.resetGame = () => {
            set(gameRef, { board: Array(9).fill(''), turn: 'Hoah' });
        };

        onValue(gameRef, (snap) => {
            const game = snap.val();
            if (!game) return;
            const cells = document.querySelectorAll('.xo-cell');
            game.board.forEach((val, i) => {
                cells[i].innerText = val;
                cells[i].className = `xo-cell ${val}`;
            });
            document.getElementById('game-status').innerText = `Turn: ${game.turn}`;
        });

        // Enter to send
        document.getElementById('chat-input').addEventListener('keypress', (e) => { if(e.key === 'Enter') sendMessage(); });

    </script>
</body>
</html>
